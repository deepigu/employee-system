<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { margin-bottom: 10px; }
    input, button { margin: 5px 0; padding: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    .section { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>

<h2>Admin Dashboard</h2>
<p>Welcome, <span id="adminName"></span></p>

<div class="section">
  <h3>Add New Employee</h3>
  <input type="text" id="employee_id" placeholder="Employee ID" />
  <input type="text" id="name" placeholder="Name" />
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Password" />
  <select id="role">
    <option value="employee">Employee</option>
    <option value="admin">Admin</option>
  </select>
  <button onclick="addEmployee()">Add Employee</button>
  <p id="addMsg" style="color:green;"></p>
</div>

<div class="section">
  <h3>Employee Logs</h3>
  <button onclick="fetchLogs()">Refresh Logs</button>
  <table id="logsTable">
    <thead>
      <tr>
        <th>Employee ID</th>
        <th>Action</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody>
      <!-- Logs will appear here -->
    </tbody>
  </table>
</div>

<script>
const token = localStorage.getItem("token");
const adminName = localStorage.getItem("employee_name");
document.getElementById("adminName").innerText = adminName || "Admin";

// ----------------------------
// Add Employee
// ----------------------------
async function addEmployee() {
  const id = document.getElementById("employee_id").value.trim();
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const role = document.getElementById("role").value;

  const addMsg = document.getElementById("addMsg");
  addMsg.innerText = "";

  if (!id || !name || !email || !password || !role) {
    addMsg.style.color = "red";
    addMsg.innerText = "All fields are required";
    return;
  }

  try {
    const response = await fetch("https://employee-system-84mh.onrender.com/api/admin/add-employee", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ employee_id: id, name, email, password, role })
    });

    const data = await response.json();

    if (!response.ok) {
      addMsg.style.color = "red";
      addMsg.innerText = data.message || "Failed to add employee";
      return;
    }

    addMsg.style.color = "green";
    addMsg.innerText = `Employee added: ${data.name} (${data.role})`;

    // Clear inputs
    document.getElementById("employee_id").value = "";
    document.getElementById("name").value = "";
    document.getElementById("email").value = "";
    document.getElementById("password").value = "";
    document.getElementById("role").value = "employee";

  } catch (error) {
    console.error(error);
    addMsg.style.color = "red";
    addMsg.innerText = "Cannot connect to server";
  }
}

// ----------------------------
// Fetch Employee Logs
// ----------------------------
async function fetchLogs() {
  const tbody = document.querySelector("#logsTable tbody");
  tbody.innerHTML = "";

  try {
    const response = await fetch("https://employee-system-84mh.onrender.com/api/admin/logs", {
      headers: {
        "Authorization": "Bearer " + token
      }
    });

    const data = await response.json();

    if (!response.ok) {
      tbody.innerHTML = `<tr><td colspan="3">Error: ${data.message}</td></tr>`;
      return;
    }

    if (data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="3">No logs found</td></tr>`;
      return;
    }

    data.forEach(log => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${log.employee_id}</td><td>${log.action}</td><td>${log.timestamp}</td>`;
      tbody.appendChild(tr);
    });

  } catch (error) {
    console.error(error);
    tbody.innerHTML = `<tr><td colspan="3">Cannot connect to server</td></tr>`;
  }
}

// Fetch logs immediately on page load
fetchLogs();
</script>

</body>
</html>
