<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Employee Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ✅ PWA + ICONS -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#4f46e5">

  <!-- ✅ Browser tab icon -->
  <link rel="icon" type="image/png" href="/logo.png">

  <!-- ✅ iPhone home screen icon (Safari) -->
  <link rel="apple-touch-icon" href="/logo.png">

  <style>
    * { box-sizing: border-box; }
    body{
      margin:0;
      font-family:"Segoe UI",system-ui,Arial,sans-serif;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(135deg,#4f46e5,#9333ea);
      padding:20px;
    }
    .container{
      width:100%;
      max-width:390px;
      background:#fff;
      padding:32px 26px;
      border-radius:16px;
      box-shadow:0 18px 45px rgba(0,0,0,.25);
      text-align:center;
    }
    .logo{
      width:64px;
      height:64px;
      border-radius:16px;
      object-fit:cover;
      box-shadow:0 10px 20px rgba(0,0,0,.15);
      margin-bottom:12px;
    }
    h2{
      margin:0 0 14px;
      color:#111827;
      font-size:22px;
      font-weight:900;
    }
    .sub{
      margin:0 0 18px;
      color:#6b7280;
      font-size:13px;
      font-weight:600;
    }
    input{
      width:100%;
      padding:12px 14px;
      margin:10px 0;
      border-radius:10px;
      border:1px solid #d1d5db;
      outline:none;
      font-size:15px;
    }
    input:focus{
      border-color:#4f46e5;
      box-shadow:0 0 0 4px rgba(79,70,229,.18);
    }
    .btn{
      width:100%;
      padding:12px 14px;
      margin-top:12px;
      border:none;
      border-radius:10px;
      background:linear-gradient(135deg,#4f46e5,#9333ea);
      color:#fff;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      transition:.2s;
    }
    .btn:hover{
      transform:translateY(-2px);
      box-shadow:0 12px 22px rgba(79,70,229,.35);
    }
    #msg{
      margin-top:12px;
      font-size:14px;
      font-weight:700;
      color:red;
      min-height:18px;
    }
    .tiny{
      margin-top:14px;
      font-size:12px;
      color:#6b7280;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- ✅ Your logo from public/logo.png -->
    <img src="/logo.png" alt="Company Logo" class="logo" />

    <h2>Employee Login</h2>
    <p class="sub">Sign in to clock in and manage breaks</p>

    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />

    <button class="btn" onclick="login()">Login</button>
    <p id="msg"></p>

    <div class="tiny">Tip: On iPhone Safari → Share → Add to Home Screen</div>
  </div>

  <script>

    <script>
  // -----------------------------------
  // AUTO REDIRECT IF ALREADY LOGGED IN
  // -----------------------------------
  const token = localStorage.getItem("token");
  const role = localStorage.getItem("role");

  if (token && role) {
    if (role === "admin") {
      window.location.href = "admin.html";
    } else {
      window.location.href = "employee.html";
    }
  }

  // existing login function continues below...
    const BASE_URL = "https://employee-system-84mh.onrender.com";

    async function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const msg = document.getElementById("msg");
      msg.innerText = "";

      if (!email || !password) {
        msg.innerText = "Email and password required";
        return;
      }

      try {
        const response = await fetch(BASE_URL + "/api/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (!response.ok) {
          msg.innerText = data.message || "Login failed";
          return;
        }

        // Save to localStorage
        localStorage.setItem("token", data.token);
        localStorage.setItem("role", data.role);
        localStorage.setItem("employee_id", data.employee_id);
        localStorage.setItem("employee_name", data.name);

        // Redirect based on role
        if (data.role === "admin") {
          window.location.href = "admin.html";
        } else {
          window.location.href = "employee.html";
        }

      } catch (error) {
        console.error(error);
        msg.innerText = "Cannot connect to server";
      }
    }

    // ✅ Register service worker (needed for install on desktop)
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js")
          .then(() => console.log("✅ Service Worker registered"))
          .catch((err) => console.log("❌ SW error:", err));
      });
    }
  </script>
</body>
</html>
